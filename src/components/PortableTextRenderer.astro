---
import { PortableText } from 'astro-portabletext';
import type { PortableTextBlock } from '@types/sanity';
import PortableTextImage from './PortableTextImage.astro';

interface Props {
  content: PortableTextBlock[];
  class?: string;
}

const { content, class: className = '' } = Astro.props;

// Custom component definitions for Portable Text rendering
const components = {
  type: {
    image: PortableTextImage,
  },
  block: {
    h1: 'h1',
    h2: 'h2',
    h3: 'h3',
    h4: 'h4',
    h5: 'h5',
    h6: 'h6',
    normal: 'p',
    blockquote: 'blockquote',
  },
  list: {
    bullet: 'ul',
    number: 'ol',
  },
  listItem: {
    bullet: 'li',
    number: 'li',
  },
  marks: {
    strong: 'strong',
    em: 'em',
    code: 'code',
    underline: 'u',
    'strike-through': 's',
  },
};
---

<div class:list={['portable-text', className]}>
  <PortableText value={content} components={components} />
</div>

<style is:global>
  /* Portable Text Typography Styles */
  .portable-text {
    @apply text-gray-800 dark:text-gray-200 leading-relaxed;
  }

  /* Headings */
  .portable-text h1 {
    @apply text-4xl font-bold mt-10 mb-4 text-gray-900 dark:text-white;
  }

  .portable-text h2 {
    @apply text-3xl font-bold mt-8 mb-4 text-gray-900 dark:text-white;
  }

  .portable-text h3 {
    @apply text-2xl font-semibold mt-6 mb-3 text-gray-900 dark:text-white;
  }

  .portable-text h4 {
    @apply text-xl font-semibold mt-5 mb-2 text-gray-900 dark:text-white;
  }

  .portable-text h5 {
    @apply text-lg font-medium mt-4 mb-2 text-gray-900 dark:text-white;
  }

  .portable-text h6 {
    @apply text-base font-medium mt-4 mb-2 text-gray-900 dark:text-white;
  }

  /* Paragraphs */
  .portable-text p {
    @apply mb-4 text-base;
  }

  /* Lists */
  .portable-text ul {
    @apply list-disc list-inside mb-4 space-y-2 pl-4;
  }

  .portable-text ol {
    @apply list-decimal list-inside mb-4 space-y-2 pl-4;
  }

  .portable-text li {
    @apply text-base;
  }

  /* Blockquotes */
  .portable-text blockquote {
    @apply border-l-4 border-gray-300 dark:border-gray-600 pl-4 py-2 my-4 italic text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 rounded-r;
  }

  /* Links */
  .portable-text a {
    @apply text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 underline transition-colors;
  }

  /* Inline code */
  .portable-text code {
    @apply bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 px-1.5 py-0.5 rounded text-sm font-mono;
  }

  /* Code blocks (if using custom code block type) */
  .portable-text pre {
    @apply bg-gray-900 dark:bg-gray-950 text-gray-100 p-4 rounded-lg overflow-x-auto my-4;
  }

  .portable-text pre code {
    @apply bg-transparent text-inherit p-0;
  }

  /* Images */
  .portable-text img {
    @apply max-w-full h-auto rounded-lg my-6 shadow-md dark:shadow-gray-900/50;
  }

  .portable-text figure {
    @apply my-6;
  }

  .portable-text figcaption {
    @apply text-center text-sm text-gray-600 dark:text-gray-400 mt-2;
  }

  /* Strong and emphasis */
  .portable-text strong {
    @apply font-bold text-gray-900 dark:text-white;
  }

  .portable-text em {
    @apply italic;
  }

  /* Strikethrough */
  .portable-text s {
    @apply line-through;
  }

  /* Underline */
  .portable-text u {
    @apply underline;
  }

  /* Horizontal rule */
  .portable-text hr {
    @apply border-t border-gray-300 dark:border-gray-700 my-8;
  }

  /* Table styles */
  .portable-text table {
    @apply w-full border-collapse my-6;
  }

  .portable-text th {
    @apply bg-gray-100 dark:bg-gray-800 text-left p-3 font-semibold text-gray-900 dark:text-white border border-gray-200 dark:border-gray-700;
  }

  .portable-text td {
    @apply p-3 border border-gray-200 dark:border-gray-700;
  }

  .portable-text tr:nth-child(even) {
    @apply bg-gray-50 dark:bg-gray-800/50;
  }
</style>
